DROP TABLE IF EXISTS device;
DROP TABLE IF EXISTS alarm;
DROP TABLE IF EXISTS dump;

CREATE TABLE device (
  deveui CHAR(16) PRIMARY KEY,
  name VARCHAR(32) UNIQUE NOT NULL,
  appkey CHAR(32) NOT NULL,
  created TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  description VARCHAR(512) NOT NULL
);

CREATE TABLE alarm (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  devid VARCHAR (64),
  deveui CHAR(16),
  created TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  level SMALLINT ,
  message VARCHAR(255),
  FOREIGN KEY (deveui) REFERENCES device (deveui)
);

CREATE TABLE dump (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  created TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  url TEXT,
  dumped TEXT
);
